### Redis AOF如何运行,为什么需要三种策略同步
![](image-20230805213923576.png)


Client(客户)作为命令的来源,会有多个源头以及源源不断的请求命令

Redis并不是直接写入Redis server,而是将这些命令放入AOF区域缓存中保存,这片区域实际上是Redis内存中的一片区域
存在的目的是当这些命令达到一定量时写入磁盘,避免频繁的IO操作

据此AOF缓冲根据AOF缓冲区的同步文件的==三种写回策略将命令写入磁盘上的AOF文件==

为避免写入AOF内容的增加而导致的文件膨胀,会根据规则合并命令(AOF重写),从而起到压缩文件的目的
#### 同步三种策略[#](https://www.cnblogs.com/StKali/p/13087736.html#%E5%90%8C%E6%AD%A5%E4%B8%89%E7%A7%8D%E7%AD%96%E7%95%A5)

当写命令写入aof_buf缓冲区后，redis会将缓冲区的命令写入到文件，redis提供了三种同步策略，由配置参数`appendfsync`决定，下面是每个策略所对应的含义：

`no`

不使用fsync方法同步，而是交给操作系统write函数去执行同步操作，在linux操作系统中大约每30秒执行一次 `sync`（man 2 sync 查看）。这种情况下，缓冲区数据同步不可控，并且在大量的写操作下，aof_buf缓冲区会堆积会越来越严重，一旦redis出现故障，数据丢失严重，整体不可控。

`always`

表示每次有写操作都调用fsync方法强制内核将数据写入到aof文件。这种情况下由于每次写命令都写到了文件中, 虽然数据比较安全，但是因为每次写操作都会同步到AOF文件中，所以在性能上会有影响，同时由于频繁的IO操作，硬盘的使用寿命会降低。

`everysec`

数据将使用调用操作系统write写入文件，并使用fsync每秒一次从内核刷新到磁盘。 这是折中的方案，兼顾性能和数据安全，所以redis默认推荐使用该配置。